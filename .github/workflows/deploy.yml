name: Deploy La Matriu

on: 
  push: 
    branches: 
      - main

permissions: 
  contents: write

jobs: 
  build-and-deploy: 
    runs-on: ubuntu-latest 
    
    steps: 
      - name: Checkout 
        uses: actions/checkout@v4
      
      - name: Inject API Key
        run: |
          echo "üîë Injectant API Key..."
          # Buscar i substituir en tots els fitxers HTML i JS
          find . -type f \( -name "*.html" -o -name "*.js" \) -exec sed -i "s/REPLACE_ME_WITH_API_KEY/${{ secrets.GEMINI_API_KEY }}/g" {} +
          echo "‚úÖ API Key injectada"
          
      - name: Verify Injection
        run: |
          echo "üîç Verificant substituci√≥..."
          # Comprovar que no quedi cap REPLACE_ME_WITH_API_KEY
          if grep -r "REPLACE_ME_WITH_API_KEY" --include="*.html" --include="*.js" .; then
            echo "‚ö†Ô∏è ADVERT√àNCIA: Encara hi ha fitxers sense substituir"
          else
            echo "‚úÖ Tots els placeholders han estat substitu√Øts"
          fi
      
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: .
          branch: gh-pages
